<!doctype html>
<html lang="hr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<title>Nalaz</title>

    <!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    	
	<!-- Custom CSS -->
	<style>
		pre {white-space: pre-wrap;}
	</style>
</head>

<body onload="time()" class="bg-light">
	<div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow">
		<h5 class="my-0 mr-md-auto font-weight-normal">Nalaz</h5>
		<button class="btn btn-success m-2 my-sm-0" name="button-demo" style="info" id="button-demo" onclick="demo()">Demo sadržaj</button>
		<button class="btn btn-danger m-2 my-sm-0" name="button-novi-nav" style="info" id="button-novi-nav" data-toggle="modal" data-target=".bd-zatvori-modal-sm">Novi nalaz</button> 
		<span class="navbar-text">Početak pregleda: <span id="time" class="font-weight-bold"></span></span>
	</div>
	<div class="container my-4">
		<form id="rendered-form">
			<div class="form-group row">
				<label for="text-pacijent" class="col-sm-2 col-form-label">Pacijent</label>
				<div class="col-sm-10"><input type="text" class="form-control" name="text-pacijent" id="text-pacijent"></div>
			</div>
			<div class="form-group row">  
				<label for="radio-group-pregled" class="fb-radio-group-label col-sm-2 col-form-label">Pregled</label>
				<div class="radio-group col-sm-10">
					<div class="form-check form-check-inline">
						<input class="form-check-input" type="radio" name="radio-group-pregled" id="prvi" value="Prvi pregled">
						<label for="prvi">prvi</label>
					</div>
					<div class="form-check form-check-inline">
						<input class="form-check-input" type="radio" name="radio-group-pregled" id="kontrolni" value="Kontrolni pregled">
						<label for="kontrolni">kontrolni</label>
					</div>
					<div class="form-check form-check-inline">
						<input class="form-check-input" type="radio" name="radio-group-pregled" id="HNA" value="HITNA NEUROLOŠKA AMBULANTA">
						<label for="HNA">HNA</label>
					</div>
				</div>
			</div>
			<div class="form-group row">
				<label for="text-razlog" class="col-sm-2 col-form-label">Razlog dolaska</label>
				<div class="col-sm-10"><input type="text" class="form-control" name="text-razlog" id="text-razlog"></div>
			</div>
			<div class="form-group"><label for="textarea-sadanja">Sadašnja bolest</label><textarea class="form-control" name="textarea-sadanja" rows="5" id="textarea-sadanja"></textarea></div>
			<div class="form-group"><label for="textarea-dosadasnje">Dosadašnje bolesti</label><textarea class="form-control" name="textarea-dosadasnje" rows="5" id="textarea-dosadasnje"></textarea></div>
			<div class="form-group"><label for="textarea-terapija">Kronična terapija</label><textarea  class="form-control" name="textarea-terapija" rows="2" id="textarea-terapija"></textarea></div>
			<div class="form-group row">
				<label for="text-alergije" class="col-sm-2 col-form-label">Alergije na lijekove</label>
				<div class="col-sm-10"><input type="text" class="form-control" name="text-alergije" id="text-alergije"></div>
			</div>
			<div class="form-group"><label for="textarea-nstatus">Neurološki status</label>
			<div class="btn-group btn-group-sm" role="group" aria-label="Nrl status">
				<button type="button" class="btn btn-secondary" onclick="mnstatus()">M</button>
				<button type="button" class="btn btn-secondary" onclick="znstatus()">Ž</button>
				<button type="button" class="btn btn-secondary" onclick="lnstatus()">leđa</button>
			</div> <textarea  class="form-control" name="textarea-nstatus" rows="6" id="textarea-nstatus"></textarea></div>
			<div class="form-group"><label for="textarea-sstatus">Somatski status</label>
			<div class="btn-group btn-group-sm" role="group" aria-label="Nrl status">
				<button type="button" class="btn btn-secondary" onclick="ohbpssstatus()">OHBP</button>
				<button type="button" class="btn btn-secondary" onclick="hnassstatus()">HNA</button>
			</div><textarea class="form-control" name="textarea-sstatus" rows="2" id="textarea-sstatus"></textarea></div>
			<div class="form-group"><label for="textarea-zakljucak">Zaključak</label><textarea type="textarea" class="form-control" name="textarea-zakljucak" rows="5" id="textarea-zakljucak"></textarea></div>
		</form>
		
		<button type="button" class="btn btn-success" name="button-spremi" style="info" id="button-spremi" onclick="spremi()">Spremi</button>
		<button class="btn btn-info" name="button-zavrsi" style="info" id="button-zavrsi" onclick="zavrsi()" data-toggle="modal" data-target=".bd-nalaz-modal-lg">Završi</button>
		<button class="btn btn-danger float-right" name="button-novi" style="info" id="button-novi" data-toggle="modal" data-target=".bd-zatvori-modal-sm">Novi nalaz</button> 
	</div>
	
	<div class="modal fade bd-nalaz-modal-lg" tabindex="-1" role="dialog" aria-labelledby="Nalaz" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<div class="modal-content">
				<div class="modal-header">
				<h5 class="modal-title"><span id="rpacijent"></span></h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				</div>
				<div class="modal-body">
					<h6>Anamneza i status</h6>
					<div id="snalaz" onclick="selectText('snalaz')">
<pre><span id="rpregled"></span>

Razlog dolaska: <span id="rrazlog"></span>
<span id="rsadasnja"></span>
<span id="rdosadasnja"></span>
Kronična terapija: <span id="rterapija"></span> 
Alergije na lijekove: <span id="ralergije"></span>

Neurološki status: <span id="rnstatus"></span>
<span id="rsstatus"></span></pre>
					</div>
					<hr>
					<h6>Zaključak</h6>
					<div id="szakljucak" onclick="selectText('szakljucak')">
<pre><span id="rzakljucak"></span></pre>
					</div>
				<div class="alert alert-danger d-none" role="alert" id="warnezavrsen">Prikazan je prethodni nalaz koji nije završen!</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close" id="backbutton">Vrati se i promijeni nalaz</button>
					<button type="button" class="btn btn-danger" data-dismiss="modal"  onclick="reloadPage()">Obriši nalaz i otvori novi</button>
				</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade bd-zatvori-modal-sm" tabindex="-1" role="dialog" aria-labelledby="Novi dokument" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header"><h5 class="modal-title">Upozorenje!</h5></div>
				<div class="modal-body">
					<p>Da li želite izbrisati nalaz te početi novi?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close">Vrati se</button>
					<button type="button" class="btn btn-danger" data-dismiss="modal"  onclick="reloadPage()">Novi nalaz</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Bootstrap JavaScript -->
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

	<!--  Custom JavaScript -->
	<script>
	
	// function that detects whether localStorage is both supported and available
	function storageAvailable(type) {
    try {
        var storage = window[type],
            x = '__storage_test__';
        storage.setItem(x, x);
        storage.removeItem(x);
        return true;
    }
    catch(e) {
        return e instanceof DOMException && (
            // everything except Firefox
            e.code === 22 ||
            // Firefox
            e.code === 1014 ||
            // test name field too, because code might not be present
            // everything except Firefox
            e.name === 'QuotaExceededError' ||
            // Firefox
            e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&
            // acknowledge QuotaExceededError only if there's something already stored
            storage.length !== 0;
		}
	}
	
	function definevar() {
		if (storageAvailable('localStorage')) {
			vpacijent = localStorage.getItem("spacijent");
			vpregled = localStorage.getItem("spregled");
			vrazlog = localStorage.getItem("srazlog");
			vsadasnja = localStorage.getItem("ssadasnja");
			vdosadasnja = localStorage.getItem("sdosadasnja");
			vterapija = localStorage.getItem("sterapija");
			valergije = localStorage.getItem("salergije");
			vnstatus = localStorage.getItem("snstatus");
			vsstatus = localStorage.getItem("ssstatus");
			vzakljucak = localStorage.getItem("szakljucak");
		}
		else {
			vpacijent = document.getElementById("text-pacijent").value;
			vpregled = document.getElementById("rendered-form").elements.namedItem("radio-group-pregled").value;
			vrazlog = document.getElementById("text-razlog").value;
			vsadasnja = document.getElementById("textarea-sadanja").value;
			vdosadasnja = document.getElementById("textarea-dosadasnje").value;
			vterapija = document.getElementById("textarea-terapija").value;
			valergije = document.getElementById("text-alergije").value;
			vnstatus = document.getElementById("textarea-nstatus").value;
			vsstatus = document.getElementById("textarea-sstatus").value;
			vzakljucak = document.getElementById("textarea-zakljucak").value;
		}
	}
	
	// učitaj (localStorage ili value)
	function citaj() {
		document.getElementById("rpacijent").innerHTML = vpacijent;
		document.getElementById("rpregled").innerHTML = vpregled;
		document.getElementById("rrazlog").innerHTML = vrazlog;
		document.getElementById("rsadasnja").innerHTML = vsadasnja;
		document.getElementById("rdosadasnja").innerHTML = vdosadasnja;
		document.getElementById("rterapija").innerHTML = vterapija;
		document.getElementById("ralergije").innerHTML = valergije;
		document.getElementById("rnstatus").innerHTML = vnstatus;
		document.getElementById("rsstatus").innerHTML = vsstatus;
		document.getElementById("rzakljucak").innerHTML = vzakljucak;
	}
	// šalje tekst u localStorage
	function spremi() {
		localStorage.setItem("sppregled", "true");
		localStorage.setItem("spacijent", document.getElementById("text-pacijent").value);
		localStorage.setItem("spregled", document.getElementById("rendered-form").elements.namedItem("radio-group-pregled").value);
		localStorage.setItem("srazlog", document.getElementById("text-razlog").value);
		localStorage.setItem("ssadasnja", document.getElementById("textarea-sadanja").value);
		localStorage.setItem("sdosadasnja", document.getElementById("textarea-dosadasnje").value);
		localStorage.setItem("sterapija", document.getElementById("textarea-terapija").value);
		localStorage.setItem("salergije", document.getElementById("text-alergije").value);
		localStorage.setItem("snstatus", document.getElementById("textarea-nstatus").value);
		localStorage.setItem("ssstatus", document.getElementById("textarea-sstatus").value);
		localStorage.setItem("szakljucak", document.getElementById("textarea-zakljucak").value);
		
		$( "#warnezavrsen" ).addClass( "d-none" )
	}
	
	// završava nalaz, šalje tekst u localStorage, otvara modal s učitanim lS
	function zavrsi() {
		if (storageAvailable('localStorage')) {
			spremi();
		}
		else {}
		
		definevar();
		citaj();
	}
	
	// označi tekst u <pre>
	function selectText( containerid ) {
        var node = document.getElementById( containerid );
        if ( document.selection ) {
            var range = document.body.createTextRange();
            range.moveToElementText( node  );
            range.select();
        } else if ( window.getSelection ) {
            var range = document.createRange();
            range.selectNodeContents( node );
            window.getSelection().removeAllRanges();
            window.getSelection().addRange( range );
        }
    }
	
	// vrijeme početka 
	function addZero(i) {
		if (i < 10) { i = "0" + i;}
		return i;
	}
	function time() {
		var d = new Date();
		var h = addZero(d.getHours());
		var m =  addZero(d.getMinutes());
		document.getElementById("time").innerHTML =  h + ":" + m;
	}
	
	// predefinirani statusi
	function mnstatus() {
		document.getElementById('textarea-nstatus').value += "Pri svijesti, orjentiran. Govor uredan. Vratom ne koči. Lice bez asimetrije i ispada osjeta. Bulbomotorika ureda, bez nistagmusa. Zjenice izokorične, fotoreaktibilne. Bez ispada ostalih kranijskih živaca. Ekstremitete održava u AG položaju, GMS 5/5. MTR 2+ simetrični, patološke ne izazivam. Bez ispada površinskog osjeta. Hod uredan, Romberg održava, bez dismetrije. Sfinktere kontrolira.";
	}
	function znstatus() {
		document.getElementById('textarea-nstatus').value += "Pri svijesti, orjentirana. Govor uredan. Vratom ne koči. Lice bez asimetrije i ispada osjeta. Bulbomotorika ureda, bez nistagmusa. Zjenice izokorične, fotoreaktibilne. Bez ispada ostalih kranijskih živaca. Ekstremitete održava u AG položaju, GMS 5/5. MTR 2+ simetrični, patološke ne izazivam. Bez ispada površinskog osjeta. Hod uredan, Romberg održava, bez dismetrije. Sfinktere kontrolira.";
	}
	function lnstatus() {
		document.getElementById('textarea-nstatus').value += "Urednog stanja svijesti. Vratom ne koči. Donje ekstremitete održava u položaju po Mingazziniju, GMS 5/5. Plantarna i dorzalna fleksija stopala uredne. RPT 2+ simetrični, RAT 2+ simetrični, patološke ne izazivam. Lasegue obostrano negativan. Bez ispada površinskog osjeta. Hod uredan. Sfinktere kontrolira.";
	}
	function ohbpssstatus() {
		document.getElementById('textarea-sstatus').value += "Somatski status: Kardiopulmonalno komp. Afeb. | EKG: ";
	}
	function hnassstatus() {
		document.getElementById('textarea-sstatus').value += "Somatski status: Kardiopulmonalno komp. Afeb. | RR: | puls: | EKG: ";
	}
	
	// page reload + brisanje localStoragea
	function reloadPage() {	
		location.reload();
		
		window.scrollTo(0, 0);
		
		localStorage.removeItem("sppregled");
		localStorage.removeItem("spacijent");
		localStorage.removeItem("spregled");
		localStorage.removeItem("srazlog");
		localStorage.removeItem("ssadasnja");
		localStorage.removeItem("sdosadasnja");
		localStorage.removeItem("sterapija");
		localStorage.removeItem("salergije");
		localStorage.removeItem("snstatus");
		localStorage.removeItem("ssstatus");
		localStorage.removeItem("szakljucak");
	}
	
	// ukoliko postoji nalaz koji nije pobrisan, otvara modal s lS
	if (localStorage.getItem("sppregled") == "true") {
		definevar();
		citaj();
		
		document.getElementById("text-pacijent").value = vpacijent;
		document.getElementById("text-razlog").value = vrazlog;
		document.getElementById("textarea-sadanja").value = vsadasnja;
		document.getElementById("textarea-dosadasnje").value = vdosadasnja;
		document.getElementById("textarea-terapija").value = vterapija;
		document.getElementById("text-alergije").value = valergije;
		document.getElementById("textarea-nstatus").value = vnstatus;
		document.getElementById("textarea-sstatus").value = vsstatus;
		document.getElementById("textarea-zakljucak").value = vzakljucak;
		
		$( "#warnezavrsen" ).removeClass( "d-none" )

		$(document).ready(function () {
			$('.bd-nalaz-modal-lg').modal('show');
		});
	}
	
	function demo() {
		document.getElementById("text-pacijent").value = "Ivan Horvat";
		document.getElementById("prvi").checked = true;
		document.getElementById("text-razlog").value = "Bol u donjem dijelu leđa sa širenjem u lijevu nogu.";
		document.getElementById("textarea-sadanja").value = "Zadnja 3 tjedna osjeća bolnost lijevo lumbalno sa širenjem u lijevu nogu, do koljena. Tegobama prethodila fizička aktivnost. Nije prije imao sličnih tegoba. Nekad zna osjetitit trnce u spomenutom području. Negira smetnje sfinktera.";
		document.getElementById("textarea-dosadasnje").value = "Apendektomiran 2012.g. Artroskopija desnog koljena 2014.g. Gastritis.";
		document.getElementById("textarea-terapija").value = "Peptoran tbl pp";
		document.getElementById("text-alergije").value = "Negira";
		document.getElementById("textarea-nstatus").value = "Urednog stanja svijesti. Vratom ne koči. Donje ekstremitete održava u položaju po Mingazziniju, GMS 5/5. Plantarna i dorzalna fleksija stopala uredne. RPT 2+ simetrični, RAT 2+ simetrični, patološke ne izazivam. Lasegue terminalno pozitivan lijevo. Bez ispada površinskog osjeta. Hod uredan. Sfinktere kontrolira.";
		document.getElementById("textarea-sstatus").value = "Kardiopulmonalno komp. Afeb.";
		document.getElementById("textarea-zakljucak").value = "Bez akutnog neurološkog zbivanja. Mirovanje i pošteda. Analgetska terapija u slčaju jačih bolova. Izbjegavati provocirajući položaj. Lagana medicinska gimnastika. Uputiti fizijatru u slučaju perzistiranja tegoba.";
	}
	</script>
	
</body>
</html>